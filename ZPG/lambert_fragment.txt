#version 330

#define MAX_LIGHTS 4

struct Light {
    vec3 lightPosition;
    vec3 lightColor;
    float ambientStrength;
};

in vec3 fragNormal;
in vec3 fragPos;
out vec4 frag_colour;

uniform Light lights[MAX_LIGHTS];
uniform int numLights;
uniform vec3 objectColor;

uniform float constant = 1.0;
uniform float linear = 0.09;
uniform float quadratic = 0.032;

void main() {
    vec4 result = vec4(0.0);
    vec3 norm = normalize(fragNormal);

    for (int i = 0; i < numLights; i++) {
        vec3 lightVector = normalize(lights[i].lightPosition - fragPos);
        float distance = length(lights[i].lightPosition - fragPos);
        float attenuation = 1.0 / (constant + linear * distance + quadratic * (distance * distance));

        vec4 ambient = vec4(lights[i].ambientStrength * lights[i].lightColor, 1.0);

        float diff = max(dot(norm, lightVector), 0.0);
        vec4 diffuse = diff * vec4(lights[i].lightColor, 1.0);

        result += (ambient + diffuse) * attenuation;
    }

    frag_colour = result * vec4(objectColor, 1.0);
}