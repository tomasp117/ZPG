#version 330

#define MAX_LIGHTS 4

struct Light {
    vec3 lightPosition;
    vec3 lightColor;
    float ambientStrength;
    vec3 lightDir;
    int lightType;
};

in vec3 fragNormal;
in vec3 fragPos;
out vec4 frag_colour;

uniform Light lights[MAX_LIGHTS];
uniform int numLights;
uniform vec3 objectColor;

uniform float quadratic = 0.25;

void main() {
    vec4 result = vec4(0.0);
    vec3 norm = normalize(fragNormal);

    for (int i = 0; i < numLights; i++) {
        vec3 lightVector = normalize(lights[i].lightPosition - fragPos);
        float distance = length(lights[i].lightPosition - fragPos);
        float attenuation = 1.0 / (quadratic * (distance * distance));

        vec4 ambient = vec4(lights[i].ambientStrength * lights[i].lightColor, 1.0);

        float diff = max(dot(norm, lightVector), 0.0);
        vec4 diffuse = diff * vec4(lights[i].lightColor, 1.0);

        float spot = dot(normalize(lightDir), -lightVector);

        if (spot < 0.99) {
            spec = 0; diff = 0;
	    }
        spot=(spot-0.99)/(1-0.99);
        result += (ambient + diffuse * spot) * attenuation;
    }

    frag_colour = result * vec4(objectColor, 1.0);
}